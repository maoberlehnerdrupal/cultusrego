<?php

function cultusrego_menu() {
  $items = array();
  $items['admin/config/cultusrego'] = array(
    'title' => 'cultusrego module settings',
    'description' => 'Basic configuration for the cultusrego styleguide generator.',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('cultusrego_admin'),
    'access arguments' => array('administer cultusrego settings'),
   );
  $items[variable_get('cultusrego_path', 'styleguide')] = array(
    'title' => 'Styleguide',
    'description' => 'cultusrego styleguide.',
    'page callback' => 'cultusrego_view_styleguide',
    'access arguments' => array('view cultusrego styleguide'),
   );

  return $items;
}

function cultusrego_permission() {
  return array(
    'administer cultusrego settings' => array(
      'title' => t('Administer cultusrego'),
      'description' => t('Perform administration tasks for cultusrego.'),
    ),
    'view cultusrego styleguide' => array(
      'title' => t('View cultusrego styleguide'),
      'description' => t('View the styleguide generated by cultusrego.'),
    ),
  );
}

function cultusrego_admin() {
  $form = array();
  $form['cultusrego_source'] = array(
    '#type' => 'textarea',
    '#title' => t('Source files'),
    '#default_value' => variable_get('cultusrego_source'),
    '#description' => t('The CSS files that should be scanned for styleguide comment blocks. (One per line)'),
  );
  $form['cultusrego_path'] = array(
    '#type' => 'textfield',
    '#title' => t('Path'),
    '#default_value' => variable_get('cultusrego_path', 'styleguide'),
    '#description' => t('The path where you can view the styleguide.'),
  );

  return system_settings_form($form);
}

function cultusrego_view_styleguide() {
  $styleguide = new cultusrego(array(
    'source' => 'sites/all/themes/test/css/style.css',
    'title' => variable_get('site_name'),
    'description' => variable_get('site_slogan'),
    'base_path' => drupal_get_path('module', 'cultusrego') . '/theme/',
    'template_folder' => __DIR__ . '/theme/vendor/cultusrego_theme_default/template',
    'twig_cache' => FALSE,
  ));
  $styleguide->render();
}
